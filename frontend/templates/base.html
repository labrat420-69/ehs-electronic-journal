<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}EHS Electronic Journal{% endblock %}</title>
    
    <!-- Google Fonts - Inter (DeskApp Style) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- DeskApp Style CSS Framework -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- DeskApp Theme CSS -->
    <link rel="stylesheet" href="{{ url_for('static', path='/css/deskapp-theme.css') }}">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', path='/css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='/css/components.css') }}">
    {% block extra_css %}{% endblock %}
</head>
<body class="deskapp-body">
    <div class="pre-loader">
        <div class="ana-spin"></div>
    </div>
    
    <!-- Main Container -->
    <div class="main-container">
        <!-- Left Sidebar -->
        <div class="left-side-bar">
            <!-- Brand -->
            <div class="brand-logo">
                <a href="/dashboard">
                    <img src="{{ url_for('static', path='/images/ehs-logo.png') }}" alt="EHS Labs" class="dark-logo" onerror="this.style.display='none'">
                    <span class="brand-title">EHS Labs</span>
                </a>
                <div class="close-sidebar" data-toggle="left-sidebar-close">
                    <i class="ion-close-round"></i>
                </div>
            </div>
            
            <!-- Menu -->
            <div class="menu-block customscroll">
                <div class="sidebar-menu">
                    <!-- Clock Widget -->
                    <div class="clock-widget">
                        <div class="widget-style3 card-box">
                            <div class="current-time" id="current-time">
                                {{ current_time_est }}
                            </div>
                            <div class="timezone-label">EST</div>
                        </div>
                    </div>
                    
                    <!-- Navigation Menu -->
                    <ul class="metismenu" id="menu">
                        <li>
                            <a href="/dashboard" class="{% if request.url.path == '/dashboard' %}active{% endif %}">
                                <i class="icon-copy dw dw-speedometer"></i>
                                <span class="mtext">Dashboard</span>
                            </a>
                        </li>
                        
                        <li>
                            <a href="/analytics" class="{% if request.url.path == '/analytics' %}active{% endif %}">
                                <i class="icon-copy dw dw-analytics-1"></i>
                                <span class="mtext">Analytics</span>
                            </a>
                        </li>
                
                        <!-- Chemical Inventory Section -->
                        <li>
                            <a href="javascript:;" class="dropdown-toggle">
                                <i class="icon-copy dw dw-flask"></i>
                                <span class="mtext">Chemical Inventory</span>
                            </a>
                            <ul class="submenu">
                                <li><a href="/chemical_inventory/">Inventory Log</a></li>
                                <li><a href="/chemical_inventory/add">Add Chemical</a></li>
                                <li><a href="/chemical_inventory/history">History</a></li>
                            </ul>
                        </li>
                        
                        <!-- Reagents Section -->
                        <li>
                            <a href="javascript:;" class="dropdown-toggle">
                                <i class="icon-copy dw dw-test-tube"></i>
                                <span class="mtext">Reagents</span>
                            </a>
                            <ul class="submenu">
                                <li><a href="/reagents/mm">MM Reagents</a></li>
                                <li><a href="/reagents/pb">Pb Reagents</a></li>
                                <li><a href="/reagents/tclp">TCLP Reagents</a></li>
                            </ul>
                        </li>
                        
                        <!-- Standards Section -->
                        <li>
                            <a href="javascript:;" class="dropdown-toggle">
                                <i class="icon-copy dw dw-balance"></i>
                                <span class="mtext">Standards</span>
                            </a>
                            <ul class="submenu">
                                <li><a href="/standards/mm">MM Standards</a></li>
                                <li><a href="/standards/flameaa">FlameAA Standards</a></li>
                            </ul>
                        </li>
                        
                        <!-- Equipment Section -->
                        <li>
                            <a href="javascript:;" class="dropdown-toggle">
                                <i class="icon-copy dw dw-tools"></i>
                                <span class="mtext">Equipment</span>
                            </a>
                            <ul class="submenu">
                                <li><a href="/equipment/">Equipment Log</a></li>
                                <li><a href="/equipment/pipettes">Pipette Log</a></li>
                                <li><a href="/equipment/water-conductivity">Water Conductivity</a></li>
                            </ul>
                        </li>
                        
                        <!-- Maintenance Section -->
                        <li>
                            <a href="javascript:;" class="dropdown-toggle">
                                <i class="icon-copy dw dw-settings2"></i>
                                <span class="mtext">Maintenance</span>
                            </a>
                            <ul class="submenu">
                                <li><a href="/maintenance/icp-oes">ICP-OES Maintenance</a></li>
                                <li><a href="/maintenance/">Maintenance Dashboard</a></li>
                            </ul>
                        </li>
                
                        
                        <!-- User Management (Admin only) -->
                        {% if current_user and current_user.role == 'admin' %}
                        <li>
                            <a href="javascript:;" class="dropdown-toggle">
                                <i class="icon-copy dw dw-user-13"></i>
                                <span class="mtext">Administration</span>
                            </a>
                            <ul class="submenu">
                                <li><a href="/auth/users">User Management</a></li>
                                <li><a href="/admin/departments">Departments</a></li>
                            </ul>
                        </li>
                        {% endif %}
                    </ul>
                </div>
                
                <!-- User Profile Section -->
                <div class="user-profile">
                    {% if current_user %}
                    <div class="user-info-dropdown">
                        <div class="dropdown">
                            <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">
                                <span class="user-icon">
                                    <img src="{{ url_for('static', path='/images/user-default.png') }}" alt="User" onerror="this.style.display='none'">
                                </span>
                                <span class="user-name">{{ current_user.full_name }}</span>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right">
                                <a class="dropdown-item" href="/auth/profile"><i class="dw dw-user1"></i> Profile</a>
                                <a class="dropdown-item" href="/auth/logout"><i class="dw dw-logout"></i> Log Out</a>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="login-section">
                        <a href="/auth/login" class="btn btn-primary btn-sm">
                            <i class="fa fa-sign-in-alt"></i> Login
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="mobile-menu-overlay"></div>
        
        <div class="main-container">
            <div class="pd-ltr-20 xs-pd-20-10">
                <!-- Header -->
                <div class="header">
                    <div class="header-left">
                        <div class="menu-icon dw dw-menu"></div>
                        <div class="search-toggle-icon dw dw-search2" data-toggle="header_search"></div>
                        <div class="header-search">
                            <form>
                                <div class="form-group mb-0">
                                    <i class="dw dw-search2 search-icon"></i>
                                    <input type="text" class="form-control search-input" placeholder="Search Here">
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="header-right">
                        <div class="dashboard-setting user-notification">
                            <div class="dropdown">
                                <a class="dropdown-toggle no-arrow" href="javascript:;" data-toggle="right-sidebar">
                                    <i class="dw dw-settings2"></i>
                                </a>
                            </div>
                        </div>
                        {% if current_user %}
                        <div class="user-info-dropdown">
                            <div class="dropdown">
                                <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">
                                    <span class="user-icon">
                                        <img src="{{ url_for('static', path='/images/user-default.png') }}" alt="User" onerror="this.style.display='none'">
                                    </span>
                                    <span class="user-name">{{ current_user.full_name.split(' ')[0] }}</span>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a class="dropdown-item" href="/auth/profile"><i class="dw dw-user1"></i> Profile</a>
                                    <a class="dropdown-item" href="/auth/logout"><i class="dw dw-logout"></i> Log Out</a>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Page Content -->
                <div class="min-height-200px">
                    <!-- Page Header -->
                    <div class="page-header">
                        <div class="row">
                            <div class="col-md-6 col-sm-12">
                                <div class="title">
                                    <h4>{% block page_title %}EHS Electronic Journal{% endblock %}</h4>
                                </div>
                                <nav aria-label="breadcrumb" role="navigation">
                                    <ol class="breadcrumb">
                                        {% block breadcrumb %}
                                        <li class="breadcrumb-item"><a href="/dashboard">Home</a></li>
                                        <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
                                        {% endblock %}
                                    </ol>
                                </nav>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Flash Messages -->
                    {% if get_flashed_messages %}
                    <div class="flash-messages">
                        {% for category, message in get_flashed_messages(with_categories=true) %}
                        <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                            <i class="fa fa-{% if category == 'error' %}exclamation-triangle{% elif category == 'success' %}check-circle{% else %}info-circle{% endif %}"></i>
                            {{ message }}
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <!-- URL Parameter Messages -->
                    <div id="url-messages"></div>
                    
                    <!-- Main Content -->
                    <div class="card-box pd-20 height-100-p mb-30">
                        {% block content %}
                        <!-- Page content goes here -->
                        {% endblock %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <!-- jQuery & Bootstrap JS (fallback if CDN fails) -->
    <script>
        // Load jQuery with fallback
        if (typeof jQuery === 'undefined') {
            document.write('<script src="https://code.jquery.com/jquery-3.6.0.min.js"><\/script>');
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js" onerror="console.log('Bootstrap CSS failed to load from CDN')"></script>
    
    <!-- Custom JS -->
    <script src="{{ url_for('static', path='/js/main.js') }}"></script>
    <script src="{{ url_for('static', path='/js/sidebar.js') }}"></script>
    <script src="{{ url_for('static', path='/js/clock.js') }}"></script>
    {% block extra_js %}{% endblock %}
    
    <!-- Initialize components -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize sidebar
            if (typeof initializeSidebar === 'function') {
                initializeSidebar();
            }
            
            // Initialize real-time clock
            if (typeof initializeClock === 'function') {
                initializeClock();
            }
            
            // Initialize flash message handlers
            if (typeof initializeFlashMessages === 'function') {
                initializeFlashMessages();
            }
            
            // Initialize URL parameter messages
            if (typeof initializeUrlMessages === 'function') {
                initializeUrlMessages();
            }
            
            // DeskApp-style dropdown toggle (vanilla JS fallback)
            function initializeDropdowns() {
                const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
                dropdownToggles.forEach(function(toggle) {
                    if (toggle.getAttribute('href') === 'javascript:;') {
                        toggle.addEventListener('click', function(e) {
                            e.preventDefault();
                            const submenu = this.nextElementSibling;
                            if (submenu && submenu.classList.contains('submenu')) {
                                // Toggle submenu visibility
                                if (submenu.style.display === 'none' || submenu.style.display === '') {
                                    submenu.style.display = 'block';
                                    this.classList.add('active');
                                    this.parentElement.classList.add('active');
                                } else {
                                    submenu.style.display = 'none';
                                    this.classList.remove('active');
                                    this.parentElement.classList.remove('active');
                                }
                            }
                        });
                    }
                });
            }
            
            // Initialize dropdowns
            initializeDropdowns();
            
            // Mobile menu toggle
            const menuIcon = document.querySelector('.menu-icon');
            const sidebar = document.querySelector('.left-side-bar');
            const overlay = document.querySelector('.mobile-menu-overlay');
            
            if (menuIcon && sidebar) {
                menuIcon.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                    if (overlay) {
                        overlay.style.display = sidebar.classList.contains('active') ? 'block' : 'none';
                    }
                });
            }
            
            if (overlay) {
                overlay.addEventListener('click', function() {
                    sidebar.classList.remove('active');
                    this.style.display = 'none';
                });
            }
            
            // Page-specific initialization
            {% block page_init %}{% endblock %}
        });
    </script>
</body>
</html>