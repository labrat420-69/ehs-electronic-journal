{% extends "base.html" %}

{% block title %}Dashboard - EHS Electronic Journal{% endblock %}
{% block page_title %}EHS Electronic Journal Dashboard{% endblock %}

{% block content %}
<div class="dashboard-grid">
    <!-- Chemical Inventory Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-flask" style="color: var(--primary-color); margin-right: 8px;"></i>
                Chemical Inventory
            </h3>
        </div>
        <div class="card-body">
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-number">{{ stats.chemical_inventory.total_active }}</span>
                    <span class="stat-label">Total Active</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.chemical_inventory.low_stock }}</span>
                    <span class="stat-label">Low Stock</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.chemical_inventory.expired }}</span>
                    <span class="stat-label">Expired</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.chemical_inventory.recent_activity }}</span>
                    <span class="stat-label">Recent Activity</span>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <div class="btn-group">
                <a href="/chemical_inventory/" class="btn btn-primary btn-sm">
                    <i class="fas fa-list"></i> View Inventory
                </a>
                <a href="/chemical_inventory/add" class="btn btn-outline btn-sm">
                    <i class="fas fa-plus"></i> Add Chemical
                </a>
            </div>
        </div>
    </div>

    <!-- Reagents Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-vial" style="color: var(--secondary-color); margin-right: 8px;"></i>
                Reagents
            </h3>
        </div>
        <div class="card-body">
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-number">{{ stats.reagents.mm_active }}</span>
                    <span class="stat-label">MM Active</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.reagents.pb_active }}</span>
                    <span class="stat-label">Pb Active</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.reagents.tclp_active }}</span>
                    <span class="stat-label">TCLP Active</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.reagents.total_active }}</span>
                    <span class="stat-label">Total Active</span>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <div class="btn-group">
                <a href="/reagents/mm" class="btn btn-primary btn-sm">
                    <i class="fas fa-vial"></i> MM Reagents
                </a>
                <a href="/reagents/pb" class="btn btn-outline btn-sm">
                    <i class="fas fa-vial"></i> Pb Reagents
                </a>
            </div>
        </div>
    </div>

    <!-- Standards Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-balance-scale" style="color: var(--success-color); margin-right: 8px;"></i>
                Standards
            </h3>
        </div>
        <div class="card-body">
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-number">{{ stats.standards.mm_standards }}</span>
                    <span class="stat-label">MM Standards</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.standards.flameaa_standards }}</span>
                    <span class="stat-label">FlameAA Standards</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.standards.total_active }}</span>
                    <span class="stat-label">Total Active</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.standards.verified if stats.standards.verified is not none else '-' }}</span>
                    <span class="stat-label">Verified</span>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <div class="btn-group">
                <a href="/standards/mm" class="btn btn-primary btn-sm">
                    <i class="fas fa-balance-scale"></i> MM Standards
                </a>
                <a href="/standards/flameaa" class="btn btn-outline btn-sm">
                    <i class="fas fa-balance-scale"></i> FlameAA Standards
                </a>
            </div>
        </div>
    </div>

    <!-- Equipment Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-tools" style="color: var(--warning-color); margin-right: 8px;"></i>
                Equipment
            </h3>
        </div>
        <div class="card-body">
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-number">{{ stats.equipment.total_equipment }}</span>
                    <span class="stat-label">Total Equipment</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.equipment.overdue_calibration }}</span>
                    <span class="stat-label">Overdue Calibration</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.equipment.pipette_tests_7d }}</span>
                    <span class="stat-label">Pipette Tests (7d)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.equipment.water_tests_7d }}</span>
                    <span class="stat-label">Water Tests (7d)</span>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <div class="btn-group">
                <a href="/equipment/" class="btn btn-primary btn-sm">
                    <i class="fas fa-list"></i> Equipment List
                </a>
                <a href="/equipment/pipettes" class="btn btn-outline btn-sm">
                    <i class="fas fa-tools"></i> Pipette Log
                </a>
            </div>
        </div>
    </div>

    <!-- Maintenance Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-wrench" style="color: var(--error-color); margin-right: 8px;"></i>
                Maintenance
            </h3>
        </div>
        <div class="card-body">
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-number">{{ stats.maintenance.recent_activities }}</span>
                    <span class="stat-label">Recent Activities</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.maintenance.scheduled if stats.maintenance.scheduled is not none else '-' }}</span>
                    <span class="stat-label">Scheduled</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.maintenance.overdue if stats.maintenance.overdue is not none else '-' }}</span>
                    <span class="stat-label">Overdue</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ stats.maintenance.this_month if stats.maintenance.this_month is not none else '-' }}</span>
                    <span class="stat-label">This Month</span>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <div class="btn-group">
                <a href="/maintenance/" class="btn btn-primary btn-sm">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="/maintenance/icp-oes" class="btn btn-outline btn-sm">
                    <i class="fas fa-wrench"></i> ICP-OES Log
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Additional Information Cards -->
<div class="dashboard-grid">
    <!-- System Alerts Card -->
    <div class="card">
        <div class="card-header">
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                <h3 class="card-title">
                    <i class="fas fa-exclamation-triangle" style="color: var(--warning-color); margin-right: 8px;"></i>
                    System Alerts
                </h3>
                <button onclick="refreshAlerts()" class="btn btn-outline btn-sm">Refresh</button>
            </div>
        </div>
        <div class="card-body">
            <div id="alerts-container">
                <p style="color: var(--text-secondary); font-style: italic;">No active alerts - all systems operating normally</p>
            </div>
        </div>
    </div>

    <!-- Recent Activity Card -->
    <div class="card">
        <div class="card-header">
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                <h3 class="card-title">
                    <i class="fas fa-history" style="color: var(--info-color); margin-right: 8px;"></i>
                    Recent Activity
                </h3>
                <button onclick="refreshActivity()" class="btn btn-outline btn-sm">Refresh</button>
            </div>
        </div>
        <div class="card-body">
            <div id="activity-container">
                {% if activities %}
                {% for activity in activities %}
                <div class="activity-item" style="padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                    <div style="font-weight: var(--font-weight-medium); color: var(--text-primary);">"{{ activity.description }}"</div>
                    <div style="font-size: var(--font-size-sm); color: var(--text-secondary);">{{ activity.details }}</div>
                    <div style="font-size: var(--font-size-xs); color: var(--text-secondary); margin-top: 4px;">{{ activity.timestamp }}</div>
                </div>
                {% endfor %}
                {% else %}
                <p style="color: var(--text-secondary); font-style: italic;">No recent activity</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
// Dashboard JavaScript functionality
function refreshAlerts() {
    fetch('/api/alerts')
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('alerts-container');
            if (data.alerts && data.alerts.length > 0) {
                container.innerHTML = data.alerts.map(alert => `
                    <div class="alert-item" style="padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                        <div style="color: var(--error-color); font-weight: var(--font-weight-medium);">${alert.title}</div>
                        <div style="font-size: var(--font-size-sm); color: var(--text-secondary);">${alert.message}</div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<p style="color: var(--text-secondary); font-style: italic;">No active alerts - all systems operating normally</p>';
            }
        })
        .catch(error => console.error('Error fetching alerts:', error));
}

function refreshActivity() {
    fetch('/api/activity')
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('activity-container');
            if (data.activities && data.activities.length > 0) {
                container.innerHTML = data.activities.map(activity => `
                    <div class="activity-item" style="padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                        <div style="font-weight: var(--font-weight-medium); color: var(--text-primary);">"${activity.description}"</div>
                        <div style="font-size: var(--font-size-sm); color: var(--text-secondary);">${activity.details}</div>
                        <div style="font-size: var(--font-size-xs); color: var(--text-secondary); margin-top: 4px;">${activity.timestamp}</div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<p style="color: var(--text-secondary); font-style: italic;">No recent activity</p>';
            }
        })
        .catch(error => console.error('Error fetching activity:', error));
}
</script>
{% endblock %}
{% endblock %}