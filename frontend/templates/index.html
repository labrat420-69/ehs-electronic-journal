{% extends "base.html" %}

{% block title %}EHS Electronic Journal - Professional Laboratory Management{% endblock %}

{% block page_header %}
<div class="page-header d-print-none">
  <div class="container-xl">
    <div class="row g-2 align-items-center">
      <div class="col">
        <div class="page-pretitle">
          Environmental Hazards Services
        </div>
        <h2 class="page-title">
          ðŸ”¬ EHS Electronic Journal
        </h2>
        <div class="page-subtitle">
          Professional Laboratory Management System
        </div>
      </div>
      <div class="col-auto ms-auto d-print-none">
        <div class="btn-list">
          <a href="/docs" class="btn btn-outline-primary">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M14 3v4a1 1 0 0 0 1 1h4"/>
              <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/>
              <line x1="9" y1="9" x2="10" y2="9"/>
              <line x1="9" y1="13" x2="15" y2="13"/>
              <line x1="9" y1="17" x2="15" y2="17"/>
            </svg>
            API Documentation
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block content %}
<!-- System Status Alert -->
<div class="alert alert-success mb-4" role="alert">
  <div class="d-flex">
    <div>
      <svg xmlns="http://www.w3.org/2000/svg" class="icon alert-icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <path d="M5 12l5 5l10 -10"/>
      </svg>
    </div>
    <div>
      <h4 class="alert-title">System Status: Online</h4>
      <div class="text-muted">Database: Connected | Server: Running on Port 8000 | All systems operational</div>
    </div>
  </div>
</div>

<!-- Laboratory Modules Grid -->
<div class="row row-cards mb-4">
  <!-- Chemical Inventory -->
  <div class="col-sm-6 col-lg-4">
    <div class="card dashboard-card">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="subheader">Laboratory Management</div>
        </div>
        <div class="d-flex align-items-baseline">
          <div class="h1 mb-0 me-2">
            <i class="fas fa-flask card-icon lab-icon"></i>
          </div>
        </div>
        <div class="h3 card-title">Chemical Inventory</div>
        <div class="text-muted">
          Track and manage all laboratory chemicals, reagents, and materials with expiry dates and locations.
        </div>
        <!-- INTEGRATION POINT: Chemical inventory module actions will be added here -->
        <div class="mt-3">
          <a href="/chemical_inventory/" class="btn btn-lab-primary btn-sm">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <rect x="4" y="4" width="16" height="16" rx="2"/>
              <path d="M7 7h10v10h-10z"/>
            </svg>
            View Inventory
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Reagent Preparation -->
  <div class="col-sm-6 col-lg-4">
    <div class="card dashboard-card">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="subheader">Preparation & Analysis</div>
        </div>
        <div class="d-flex align-items-baseline">
          <div class="h1 mb-0 me-2">
            <i class="fas fa-vial card-icon lab-icon"></i>
          </div>
        </div>
        <div class="h3 card-title">Reagent Preparation</div>
        <div class="text-muted">
          Document mercury/metals, lead, and TCLP reagent preparations with full traceability.
        </div>
        <!-- INTEGRATION POINT: Reagent preparation module actions will be added here -->
        <div class="mt-3">
          <a href="/reagents/mm" class="btn btn-lab-primary btn-sm">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M9 7h6l-1 9h-4l-1 -9z"/>
              <path d="M7 7v-.5a2.5 2.5 0 0 1 5 0v.5"/>
              <path d="M12 7v-.5a2.5 2.5 0 0 1 5 0v.5"/>
            </svg>
            Manage Reagents
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Equipment Calibration -->
  <div class="col-sm-6 col-lg-4">
    <div class="card dashboard-card">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="subheader">Maintenance & QC</div>
        </div>
        <div class="d-flex align-items-baseline">
          <div class="h1 mb-0 me-2">
            <i class="fas fa-tools card-icon lab-icon"></i>
          </div>
        </div>
        <div class="h3 card-title">Equipment Calibration</div>
        <div class="text-muted">
          Maintain calibration schedules and records for all laboratory equipment.
        </div>
        <!-- INTEGRATION POINT: Equipment management module actions will be added here -->
        <div class="mt-3">
          <a href="/equipment/" class="btn btn-lab-primary btn-sm">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77 -3.77a6 6 0 0 1 -7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1 -3 -3l6.91 -6.91a6 6 0 0 1 7.94 -7.94l-3.76 3.76z"/>
            </svg>
            View Equipment
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Standards Management -->
  <div class="col-sm-6 col-lg-4">
    <div class="card dashboard-card">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="subheader">Quality Assurance</div>
        </div>
        <div class="d-flex align-items-baseline">
          <div class="h1 mb-0 me-2">
            <i class="fas fa-balance-scale card-icon lab-icon"></i>
          </div>
        </div>
        <div class="h3 card-title">Standards Management</div>
        <div class="text-muted">
          Prepare and track analytical standards for ICP-OES and Flame AA analysis.
        </div>
        <!-- INTEGRATION POINT: Standards management module actions will be added here -->
        <div class="mt-3">
          <a href="/standards/mm" class="btn btn-lab-primary btn-sm">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M7 20l10 0"/>
              <path d="M6 6l6 0l4 14l-10 0l0 -14z"/>
              <path d="M12 6l0 -1a2 2 0 0 0 -2 -2h-2a2 2 0 0 0 -2 2v1"/>
            </svg>
            Manage Standards
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Water Quality Testing -->
  <div class="col-sm-6 col-lg-4">
    <div class="card dashboard-card">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="subheader">Environmental Monitoring</div>
        </div>
        <div class="d-flex align-items-baseline">
          <div class="h1 mb-0 me-2">
            <i class="fas fa-tint card-icon lab-icon"></i>
          </div>
        </div>
        <div class="h3 card-title">Water Quality Testing</div>
        <div class="text-muted">
          Monitor and record water conductivity and quality parameters.
        </div>
        <!-- INTEGRATION POINT: Water quality monitoring module actions will be added here -->
        <div class="mt-3">
          <a href="/equipment/water-conductivity" class="btn btn-lab-primary btn-sm">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M7.502 19.423c2.602 2.105 6.395 2.105 8.996 0c2.602 -2.105 3.262 -5.708 1.566 -8.546l-4.89 -7.26c-.42 -.625 -1.287 -.803 -1.936 -.397a1.376 1.376 0 0 0 -.41 .397l-4.893 7.26c-1.695 2.838 -1.035 6.441 1.567 8.546z"/>
            </svg>
            Water Testing
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- User Management -->
  <div class="col-sm-6 col-lg-4">
    <div class="card dashboard-card">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="subheader">System Administration</div>
        </div>
        <div class="d-flex align-items-baseline">
          <div class="h1 mb-0 me-2">
            <i class="fas fa-users card-icon lab-icon"></i>
          </div>
        </div>
        <div class="h3 card-title">User Management</div>
        <div class="text-muted">
          5-tier role system: Admin, Lab Manager, Analyst, Technician, Guest.
        </div>
        <!-- INTEGRATION POINT: User management module actions will be added here -->
        <div class="mt-3">
          <a href="/auth/login" class="btn btn-lab-primary btn-sm">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2"/>
              <path d="M3 12h13l-3 -3m0 6l3 -3"/>
            </svg>
            Access System
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Access and Analytics -->
<div class="row row-cards">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Quick Access</h3>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6 col-lg-3">
            <div class="mb-3">
              <a href="/analytics" class="btn btn-outline-primary w-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                  <polyline points="3,12 7,8 13,16 21,6"/>
                </svg>
                Analytics Dashboard
              </a>
              <!-- INTEGRATION POINT: Analytics module shortcuts will be added here -->
            </div>
          </div>
          <div class="col-md-6 col-lg-3">
            <div class="mb-3">
              <a href="/waste" class="btn btn-outline-secondary w-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                  <polyline points="3,6 5,6 21,6"/>
                  <path d="M19 6v14a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-14m3 0v-2a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v2"/>
                </svg>
                Waste Management
              </a>
              <!-- INTEGRATION POINT: Waste management module shortcuts will be added here -->
            </div>
          </div>
          <div class="col-md-6 col-lg-3">
            <div class="mb-3">
              <a href="/reminders" class="btn btn-outline-warning w-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                  <path d="M10 5a2 2 0 0 1 4 0a7 7 0 0 1 4 6v3a4 4 0 0 0 2 3h-16a4 4 0 0 0 2 -3v-3a7 7 0 0 1 4 -6"/>
                  <path d="M9 17v1a3 3 0 0 0 6 0v-1"/>
                </svg>
                Reminders
              </a>
              <!-- INTEGRATION POINT: Reminder system shortcuts will be added here -->
            </div>
          </div>
          <div class="col-md-6 col-lg-3">
            <div class="mb-3">
              <a href="/notes" class="btn btn-outline-success w-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                  <rect x="4" y="4" width="16" height="16" rx="2"/>
                  <path d="M7 8h10"/>
                  <path d="M7 12h10"/>
                  <path d="M7 16h10"/>
                </svg>
                Department Notes
              </a>
              <!-- INTEGRATION POINT: Notes system shortcuts will be added here -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Login Section (for unauthenticated users) -->
{% if not current_user %}
<div class="row row-cards mt-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Login to EHS Electronic Journal</h3>
      </div>
      <div class="card-body">
        <form id="loginForm" class="row g-2">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Username</label>
              <input type="text" id="username" name="username" class="form-control" value="admin" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Password</label>
              <input type="password" id="password" name="password" class="form-control" value="admin123!" required>
            </div>
          </div>
          <div class="col-12">
            <button type="submit" class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2"/>
                <path d="M3 12h13l-3 -3m0 6l3 -3"/>
              </svg>
              Login to System
            </button>
          </div>
        </form>
        <div class="mt-3">
          <div class="alert alert-info">
            <div class="d-flex">
              <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon alert-icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="9"/>
                  <path d="M12 8l0 4"/>
                  <path d="M12 16l0 0"/>
                </svg>
              </div>
              <div>
                <h4 class="alert-title">Default Login Credentials</h4>
                <div class="text-muted">Username: <strong>admin</strong> | Password: <strong>admin123!</strong></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
// Login form handler
document.getElementById('loginForm')?.addEventListener('submit', async function(e) {
    e.preventDefault();
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    try {
        const response = await fetch('/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({username, password})
        });
        
        if (response.ok) {
            const data = await response.json();
            localStorage.setItem('token', data.access_token);
            
            // Show success toast notification using Tabler
            const toast = document.createElement('div');
            toast.className = 'toast show';
            toast.innerHTML = `
                <div class="toast-header">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon text-success me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <path d="M5 12l5 5l10 -10"/>
                    </svg>
                    <strong class="me-auto">Login Successful</strong>
                </div>
                <div class="toast-body">
                    Welcome! Redirecting to dashboard...
                </div>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                window.location.href = '/dashboard';
            }, 1500);
        } else {
            // Show error toast
            const toast = document.createElement('div');
            toast.className = 'toast show';
            toast.innerHTML = `
                <div class="toast-header">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon text-danger me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                        <circle cx="12" cy="12" r="9"/>
                        <path d="M12 8l0 4"/>
                        <path d="M12 16l0 0"/>
                    </svg>
                    <strong class="me-auto">Login Failed</strong>
                </div>
                <div class="toast-body">
                    Please check your credentials and try again.
                </div>
            `;
            document.body.appendChild(toast);
        }
    } catch (error) {
        console.error('Login error:', error);
    }
});
</script>
{% endblock %}